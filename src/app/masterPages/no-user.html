<!doctype html>
<html>
    <head>
        <title>KeyNode</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" href="/static/bootflat/css/bootflat.css">
    </head>

    <body style="background-color: rgb(235, 255, 254); overflow-y: scroll;">
        <nav class="navbar navbar-expand-lg bg-light navbar-light sticky-top">
            <div class="container">
              <a class="navbar-brand" href="#"><img src="/static/imgs/logos/logo_full.svg" style="height: 40px;"></a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Pricing</a>
                  </li>
                </ul>
                <div class="row m-2">
                  <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" class="text-center text-decoration-none text-black">Log-in</a>
                </div>
                <div class="row m-2">
                    <button class="btn btn-info fw-bold rounded-pill border-0" data-bs-toggle="modal" data-bs-target="#registerModal">Start for free</button>
                </div>
              </div>
            </div>
          </nav>

          <!-- Modal -->
          <div class="modal fade" id="registerModal" tabindex="-1">
            <div class="modal-dialog" role="document">
              <div class="modal-content rounded-5 shadow">
                <div class="modal-header p-2 pb-4 border-bottom-0 d-flex justify-content-center">
                  <h3 class="fw-bold mb-0 text-center">
                    Create an account
                  </h3>
                </div>
                <div class="modal-body p-5 pt-0">
                  <button type="button" class="btn btn-link text-decoration-none" data-bs-dismiss="modal" style="padding-left: 0px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
                    </svg>
                    Back to KeyNode
                  </button>
                  <hr>
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control rounded-4" id="register_name" placeholder="Name">
                    <label for="floatingInput">Full name</label>
                  </div>
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control rounded-4" id="register_username" placeholder="name@example.com">
                    <label for="floatingInput">Username</label>
                  </div>
                  <div class="form-floating mb-3">
                    <input type="email" class="form-control rounded-4" id="register_email" placeholder="name@example.com">
                    <label for="floatingInput">Email address</label>
                  </div>
                  <div class="form-floating mb-3">
                    <input type="password" class="form-control rounded-4" id="register_password" placeholder="Password">
                    <label for="floatingPassword">Password</label>
                  </div>
                  <button class="w-100 mb-2 btn btn-lg rounded-4 btn-primary" id="register_button" onclick="RegisterRequest(document.getElementById('register_name'), document.getElementById('register_username'), document.getElementById('register_email'), document.getElementById('register_password'), document.getElementById('register_button'), document.getElementById('register_success'), document.getElementById('register_error'), document.getElementById('register_warning'));">Sign up</button>
                  <div class="alert alert-success d-none" id="register_success" role="alert">
                    <strong>New account created!</strong> You can now log-in.
                  </div>
                  <div class="alert alert-warning d-none" id="register_warning" role="alert">
                    <strong>An user with the selected username already exists!</strong> Choose a different username and try again.
                  </div>
                  <div class="alert alert-danger d-none" id="register_error" role="alert">
                    <strong>Could not create new account!</strong> Check the inserted details and try again.
                  </div>
                  <small class="text-muted">By clicking Sign up, you agree to the <a href="#">terms of use</a> and <a href="#">privacy policy</a>.</small>
                  <hr class="my-4">
                  <p class="mb-3 text-center">Already a member? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login.</a></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal -->
          <div class="modal fade" id="loginModal" tabindex="-1">
            <div class="modal-dialog" role="document">
              <div class="modal-content rounded-5 shadow">
                <div class="modal-header p-2 pb-4 border-bottom-0 d-flex justify-content-center">
                  <h3 class="fw-bold mb-0 text-center">
                    Welcome back
                  </h3>
                </div>
                <div class="modal-body p-5 pt-0">
                  <button type="button" class="btn btn-link text-decoration-none" data-bs-dismiss="modal" style="padding-left: 0px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
                    </svg>
                    Back to KeyNode
                  </button>
                  <hr>
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control rounded-4" id="login_username" placeholder="Username">
                    <label for="floatingInput">Username</label>
                  </div>
                  <div class="form-floating mb-3">
                    <input type="password" class="form-control rounded-4" id="login_password" placeholder="Password">
                    <label for="floatingPassword">Password</label>
                  </div>
                  <button class="w-100 mb-2 btn btn-lg rounded-4 btn-primary" id="login_button" onclick="LoginRequest(document.getElementById('login_username'), document.getElementById('login_password'), document.getElementById('login_button'), document.getElementById('login_success'), document.getElementById('login_error'));">Log-in</button>
                  <div class="alert alert-success d-none" id="login_success" role="alert">
                    <strong>Successfully logged in!</strong> Opening user vault...
                  </div>
                  <div class="alert alert-danger d-none" id="login_error" role="alert">
                    <strong>Login failed!</strong> Check your username and password and try again.
                  </div>
                  <small class="text-muted">By clicking Log-in, you agree to the <a href="#">terms of use</a> and <a href="#">privacy policy</a>.</small>
                  <hr class="my-4">
                  <p class="mb-3 text-center">New to KeyNode? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Create a new account.</a></p>
                </div>
              </div>
            </div>
          </div>
          
          <script>
            function RegisterRequest(full_name, username, email_address, password, button, alert_success, alert_error, alert_warning) {
              button.disabled = true;

              alert_success.classList.add('d-none');
              alert_error.classList.add('d-none');
              
              var xhr = new XMLHttpRequest();
              xhr.open("POST", '/api/register', true);

              //Send the proper header information along with the request
              xhr.setRequestHeader("Content-Type", "application/json");

              xhr.onreadystatechange = function() { // Call a function when the state changes.
                  if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                    //alert(xhr.responseText)
                    let responseOBJ = JSON.parse(xhr.responseText);
                    if(responseOBJ.success == "true"){
                      alert_success.classList.remove('d-none');
                      setTimeout(function(){
                        window.location.href = '/';
                      }, 2000);
                    }else if(responseOBJ.success == "false"){
                      alert_error.classList.remove('d-none');
                      button.disabled = false;
                    }else if(responseOBJ.success == "username_already_exists"){
                      alert_warning.classList.remove('d-none');
                      button.disabled = false;
                    }
                  }
              }
              let payload = '{\
                "full_name":"' + full_name.value + '",\
                "username":"' + username.value + '",\
                "email_address":"' + email_address.value + '",\
                "password":"' + password.value + '"\
              }'
              xhr.send(payload);
            }

            function LoginRequest(username, password, button, alert_success, alert_error){
              button.disabled = true;

              alert_success.classList.add('d-none');
              alert_error.classList.add('d-none');
              
              var xhr = new XMLHttpRequest();
              xhr.open("POST", '/api/login', true);

              //Send the proper header information along with the request
              xhr.setRequestHeader("Content-Type", "application/json");

              xhr.onreadystatechange = function() { // Call a function when the state changes.
                  if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                    let responseOBJ = JSON.parse(xhr.responseText);
                    if(responseOBJ.success == true){
                      alert_success.classList.remove('d-none');
                      setTimeout(function(){
                        window.location.href = '/';
                      }, 2000);
                    }else if(responseOBJ.success == false){
                      alert_error.classList.remove('d-none');
                      button.disabled = false;
                    }
                  }
              }
              let payload = '{"username":"' + username.value + '","password":"' + password.value + '"}'
              xhr.send(payload);
            }
          </script>

          <!--content-->

        <!-- Bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
        

        <!-- Bootflat's JS files.-->
        <script src="/static/bootflat/js/icheck.min.js"></script>
        <script src="/static/bootflat/js/jquery.fs.selecter.min.js"></script>
        <script src="/static/bootflat/js/jquery.fs.stepper.min.js"></script>

    </body>
</html>